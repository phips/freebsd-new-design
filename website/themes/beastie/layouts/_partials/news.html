<h3>{{ i18n "latestNews" }}</h3>
{{ $newsPath := (printf "data/%s/news/news.toml" $.Language.Lang) }}
{{ $newsData := "" }}
{{ if (fileExists $newsPath) -}}
  {{ $data := index .Site.Data $.Language.Lang }}
  {{ $newsData = $data.news }}
{{ else }}
  {{ $dataDefaultLanguage := index .Site.Data .Sites.Default.Language.Lang }}
  {{ $newsData = $dataDefaultLanguage.news }}
{{ end }}

{{ with $newsData.news }}
  {{ $newsCounter := 0 }}
  {{ $newsDayCounter := 1 }}
  {{ $newsDayPrev := false }}
  {{ $newsMonthPrev := false }}
  {{ range (sort .news "date" "desc") }}
    {{ if lt $newsCounter 6 }}
      {{ $newsDayCur := dateFormat "2006-01-02" .date }}
      {{ $newsMonthCur := dateFormat "Jan 2006" .date }}
      {{ if eq $newsDayCur $newsDayPrev }}
        {{ $newsDayCounter = add $newsDayCounter 1 }}
      {{ else }}
        {{ $newsDayCounter = 1 }}
      {{ end }}
      {{ if ne $newsMonthCur $newsMonthPrev }}
      <h4 class="feed-item-date" title="{{ dateFormat "2006 01" .date }}">{{ dateFormat "2006-01" .date }}</h4>
      {{ end }}
      <p class="feed-item">
      {{ $firstLink := "" }}
      {{ $firstLink := replaceRE `.*?href="([^"]+)".*` "$1" .description }}
      <!--<a href="{{.Site.BaseURL | relLangURL }}news/newsflash/#{{ dateFormat "2006-01-02" .date }}:{{ $newsDayCounter }}">-->
      <a href="{{ $firstLink | safeHTML }}">

      {{ if .title }}
        {{ $title := replaceRE "<a .*\">" "" .title }}
        {{ $title = replaceRE "</a>" "" $title }}
        {{ $title | safeHTML }}
      {{ else }}
        {{ $description := replaceRE "<a .*\">" "" .description }}
        {{ $description = replaceRE "</a>" "" $description }}
        {{ $description | safeHTML }}
      {{ end }}
      </a>
      </p>
      {{ $newsCounter = add $newsCounter 1 }}
      {{ $newsDayPrev = $newsDayCur }}
      {{ $newsMonthPrev = $newsMonthCur }}
    {{ end }}
  {{ end }}
{{ end }}
<div class="feed-source">
  <a href="{{ printf "%s%s/%s" ($.Scratch.Get "sUrl") ($.Scratch.Get "lang") "news/newsflash/" }}">{{ i18n "more" }}</a>,
  <a href="{{ absLangURL ($.Site.BaseURL) }}news/feed.xml">Feed</a>
</div>
